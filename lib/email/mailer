import smtplib, yaml

class SelfMailer:
    def __init__(self, conffile):
        stream = open(conffile, "r")
        self.config = yaml.load(stream)
        self.login = self.config["email_login"]
        self.password = self.config["email_pass"]
        if self.config.has_key("email_server"):
            self.smtpserver = self.config["email_server"]
        else:
            self.smtpserver = "smtp.gmail.com:587"
        self.toAddress = "Gonzalo Alvarez<gonzaloab@gmail.com>"
        self.fromAddress = "Newton Server<newton@gonzaloalvarez.es>"

    def mailme(self, subject, content):
        header  = 'From: %s\n' % self.fromAddress
        header += 'To: %s\n' % self.toAddress
        header += 'Subject: %s\n\n' % subject
        message = header + content

        server = smtplib.SMTP(self.smtpserver)
        server.starttls()
        server.login(self.login, self.password)
        result = server.sendmail(self.fromAddress, self.toAddress, message)
        server.quit()
        logging.info('Email sent successfully')
        return result


